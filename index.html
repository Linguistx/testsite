<html>

<meta charset="UTF-8">
<link href="/theme/default.css" rel="stylesheet">

<body>
    <article>
        <div class="header">
            <span class="titled">Sfodaolajan - English Dictionary</span>
            <span class="searchbar">
                <span id="searchPart">
                    <input id='searchbox' autocorrect="off" autocapitalize="off" spellcheck="false"></input>
                    <img id="mag" src="/theme/magnifying-glass.svg" height="25px"></img>
                </span>
            </span>
        </div>
        <div class="navbar">
            <a href="#">Dictionary</a>
            <a href="#">Grammar</a>
            <a href="#">About</a>
        </div>
        <div class="row">
            <div class="side">
                <h2>See also ...</h2>
                <h5>Photo of me:</h5>
                <div class="fakeimg" style="height:200px;">Image</div>
                    <p>Some text about me in culpa qui officia deserunt mollit anim..</p>
                    <h3>More Text</h3>
                    <p>Lorem ipsum dolor sit ame.</p>
                </div>
        
                <div class="main">
                    <div id="entry"></div>
                <h1>styrʌʊgfdgfdg</h1>
                <p>/styɾcccc/</p>
                <h3>verb</h3>
                <ol>
                <li>say, tell</li>
                    <ul class='quotes'>
                        <li>I say he's an idiot - <span class="translation">ya satr qu el fimda</span></li>
                        <li>I say he's an idiot - <span class="translation">ya satr qu el fimda</span></li>
                    </ul>
                <li>notify, inform</li>
                <li>make</li>
                </ol>
                <h2>Etymology</h2>
                <p>BLah blhablhb</p>
                <h2>Derived terms</h2>
                </div>
            </div>
        <div class="footer">Powered by Vulgarlang.com</div>
    </article>
</body>

<script>
let url = document.location.href;
let dictionaryFile = document.location.origin + "/dictionary.txt";
let dictionary = {};
let jsonFile = new XMLHttpRequest();
 
jsonFile.open("GET", dictionaryFile, true);
jsonFile.send();
jsonFile.onreadystatechange = function() {
    console.log('readyState', jsonFile.readyState);
    if (jsonFile.readyState == 4 && jsonFile.status == 200) {
        let dictionaryBlob = jsonFile.responseText;
        dictionaryBlob = dictionaryBlob.split("@");
        for (let entry of dictionaryBlob) {
            let forwardSlash = entry.indexOf("/");
            let colon = entry.indexOf(":");
            let marker = Math.min(forwardSlash, colon);
            marker = marker > 0 ? marker : Math.max(forwardSlash, colon);
            let word = entry.slice(0, marker).trim();
            let wordData = entry.slice(marker).trim();
            if (!dictionary[word]) {
                dictionary[word] = [wordData]
            } else {
                dictionary[word].push(wordData)
            }
        }
        console.log(9, dictionary);
        if (url.includes("?")) {
            var queryTerm = decodeURI(url.slice(url.indexOf("?") + 1));
            console.log(22, dictionary[queryTerm]);
            sendEntry(queryTerm, dictionary[queryTerm]);
        } else {

        }
    }
}
    console.log(8, dictionary);

    
function sendEntry(term, associatedInfo) {
    let allEntries = [];
    for (let entry of associatedInfo) {
        let subheadings = [];
        entry = entry.split(':');
        let pronunciation = entry[0].trim();
        for (let i = 1; i < entry.length; i++) {
            let subheading = entry[i].trim();
            
            if (subheading.startsWith("ET")) {
                
            } else if (subheading.startsWith("DT")) {
                
            } else {
                let senses = subheading.split("=");
                var pos = senses[0].trim();
                var translation = "";
                for (let j = 1; j < senses.length; j++) {
                    let sense = senses[j];
                    sense = sense.split("*");
                    var translation = "<li>" + sense[0].trim() + "</li>";
                    let quotes = "";
                    for (let k = 1; k < sense.length; k++) {
                        quotes = quotes + "<li>" + sense[k].trim() + "</li>";
                    }
                    if (quotes != "") quotes = "<ul>" + quotes + "</ul>";
                    translation = translation + quotes;
                }
                
                if (translation != "") translation = "<ol>" + translation + "</ol>";
            }
            
           subheading = "<h2>" + pos + "</h2>" + translation;
            subheadings.push(subheading)
        }
            var final = "<h1>" + term + "</h1>"
            + "<p>" + pronunciation + "</p>"
            + subheadings.join();
        allEntries.push(final)
    }

    document.getElementById('entry').innerHTML = allEntries.join();
}
</script>
    
</html>
